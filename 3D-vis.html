<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; }
    #controls { display: flex; align-items: center; gap: 8px; padding: 8px; background: #f3f4f6; }
    #graph { width: 100vw; height: calc(100vh - 48px); }
    label { font-size: 14px; }
    select { padding: 4px 8px; }
    #status { margin-left: 12px; color: #555; font-size: 13px; }
  </style>

  <!-- 3D Force Graph (WebGL) -->
  <script src="//cdn.jsdelivr.net/npm/3d-force-graph"></script>
</head>

<body>
  <div id="controls">
    <label for="sd-select">Select dataset:</label>
    <select id="sd-select" aria-label="Select dataset">
      <option value="-1SD">-1SD</option>
      <option value="-2SD">-2SD</option>
      <option value="-3SD">-3SD</option>
    </select>
    <span id="status" aria-live="polite">Loaded: -1SD</span>
  </div>

  <div id="graph"></div>

  <script>
    (function(){
      const fileMap = {
        '-1SD': 'Student_Assessment_Graph_-1SD.json',
        '-2SD': 'Student_Assessment_Graph_-2SD.json',
        '-3SD': 'Student_Assessment_Graph_-3SD.json'
      };

      const select = document.getElementById('sd-select');
      const status = document.getElementById('status');
      const container = document.getElementById('graph');

      // Create single ForceGraph3D instance and reuse
      const Graph3D = ForceGraph3D({ controlType: 'orbit' })(container)
        .nodeId('id')
        .nodeLabel('id')
        .linkSource('source')
        .linkTarget('target')
        // tuning for readability
        .linkOpacity(0.6)
        .nodeRelSize(6);

      function setStatus(text) { status.textContent = text; }

      async function loadAndRender(sdKey) {
        const file = fileMap[sdKey] || fileMap['-1SD'];
        setStatus(`Loading: ${sdKey}...`);
        try {
          const res = await fetch(file);
          if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
          const data = await res.json();
          Graph3D.graphData(data);
          setStatus(`Loaded: ${sdKey}`);
        } catch (err) {
          console.error('Failed to load dataset', err);
          setStatus(`Error loading ${sdKey}`);
        }
      }

      select.addEventListener('change', () => loadAndRender(select.value));
      select.value = '-1SD';
      loadAndRender(select.value);
    })();
  </script>
</body>
